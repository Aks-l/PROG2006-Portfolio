<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>GitLab Mock Interface</title>
  <!-- Load the UMD version of ethers.js (v5) -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.2/dist/ethers.umd.min.js"></script>
</head>
<body>
  <h1>The Real GitLab</h1>
  
  <!-- Form to Create an Issue on-chain -->
  <form id="createIssueForm">
    <h2>Create Issue</h2>
    <label for="issueURL">Issue GitLab URL:</label>
    <input type="text" id="issueURL" name="issueURL" required>
    <button type="submit">Create Issue</button>
  </form>
  
  <!-- Form to Simulate a Merge Request Off-chain -->
  <form id="createMRForm">
    <h2>Create Merge Request</h2>
    <label for="mrIssueIndex">Issue Index:</label>
    <input type="number" id="mrIssueIndex" name="mrIssueIndex" min="0" required>
    <button type="submit">Create Merge Request</button>
  </form>
  
  <script>
    async function init() {
      // Connect to your local Hardhat node
      const provider = new ethers.providers.JsonRpcProvider("http://127.0.0.1:8545");
      const signer = provider.getSigner();

      // Replace with your deployed FundManager contract address
      const fundManagerAddress = "0x5FbDB2315678afecb367f032d93F642f64180aa3";
      
      // Minimal ABI for the createIssue function
      const fundManagerAbi = [
        "function createIssue(string _gitlabURL) public",
        "function createSubmission(uint issueId) public"
      ];
      
      const fundManager = new ethers.Contract(fundManagerAddress, fundManagerAbi, signer);
      
      // Handle the Create Issue form submission
      document.getElementById("createIssueForm").addEventListener("submit", async (e) => {
        e.preventDefault();
        const issueURL = document.getElementById("issueURL").value;
        try {
          const tx = await fundManager.createIssue(issueURL);
          await tx.wait();
          alert("Issue created successfully!");
        } catch (err) {
          console.error(err);
          alert("Error creating issue: " + err.message);
        }
      });
      
      document.getElementById("createMRForm").addEventListener("submit", async (e) => {
            e.preventDefault();
            const issueIndex = document.getElementById("mrIssueIndex").value;
            try {
                const tx = await fundManager.createSubmission(issueIndex);
                await tx.wait();
                alert("Merge Request created successfully!");
            } catch (err) {
                console.error(err);
                alert("Error creating merge request: " + err.message);
            }
        });
    }
    
    window.addEventListener("load", init);
  </script>
</body>
</html>
